<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>환율 계산기</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    body {
      background: #222;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      width: 100vw; height: 100vh; min-height: 100vh; min-width: 100vw;
      overflow: hidden;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
    }
    .container {
      width: 100vw; height: 100vh; min-height: 100vh; min-width: 100vw;
      display: flex; flex-direction: column; justify-content: flex-start; align-items: center;
      background: #222;
      box-sizing: border-box;
      padding: 0; margin: 0;
    }
    .currency-block {
      width: 100vw; max-width: 480px;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: #333;
      padding: 18px 0 10px 0;
    }
    .currency-row {
      width: 90vw; max-width: 400px;
      display: flex; align-items: center; justify-content: space-between;
      margin: 0 0 8px 0;
    }
    .currency-label {
      display: flex; align-items: center; font-size: 1.2em;
    }
    .currency-label img {
      width: 36px; height: 36px; border-radius: 50%; margin-right: 12px;
    }
    .currency-value {
      font-size: 2em; font-weight: bold; letter-spacing: 1px;
    }
    .swap-btn {
      width: 60px; height: 60px; border-radius: 50%;
      background: #ff9800; color: #fff; border: none;
      font-size: 2em; margin: 8px 0; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: background 0.2s;
    }
    .swap-btn:active { background: #ffa726; }
    .calc-area {
      flex: 1;
      width: 100vw; max-width: 480px;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
      background: #222;
      padding-bottom: 10px;
    }
    .calc-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      width: 90vw; max-width: 400px;
      margin: 0 auto;
    }
    .calc-btn {
      font-size: 1.3em; padding: 18px 0;
      border: none; border-radius: 8px;
      background: #444; color: #fff;
      cursor: pointer; transition: background 0.2s;
    }
    .calc-btn:active { background: #555; }
    .op { background: #ff9800; color: #fff; }
    .op:active { background: #ffa726; }
    .eq { background: #43a047; color: #fff; }
    .eq:active { background: #66bb6a; }
    .calc-display {
      width: 90vw; max-width: 400px;
      font-size: 2em; background: #222; color: #fff;
      border: none; text-align: right; padding: 10px;
      border-radius: 8px; margin-bottom: 10px; box-sizing: border-box;
    }
    @media (max-width: 500px) {
      .currency-block, .calc-area, .calc-display, .calc-buttons { max-width: 100vw; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="currency-block" id="currency-block">
      <div class="currency-row" id="row-from">
        <div class="currency-label">
          <img id="from-flag" src="https://flagcdn.com/ca.svg" alt="CAD">
          <span id="from-code">CAD</span>
        </div>
        <div class="currency-value" id="from-value">0</div>
      </div>
      <div class="currency-row" id="row-to">
        <div class="currency-label">
          <img id="to-flag" src="https://flagcdn.com/us.svg" alt="USD">
          <span id="to-code">USD</span>
        </div>
        <div class="currency-value" id="to-value">0</div>
      </div>
      <button class="swap-btn" onclick="swapCurrency()">&#8595;&#8593;</button>
    </div>
    <div class="calc-area">
      <input class="calc-display" id="calc-display" value="0" readonly />
      <div class="calc-buttons">
        <button class="calc-btn" onclick="clearAll()">C</button>
        <button class="calc-btn" onclick="backspace()">&larr;</button>
        <button class="calc-btn" onclick="swapCurrency()">&#8595;&#8593;</button>
        <button class="calc-btn op" onclick="pressOp('/')">÷</button>
        <button class="calc-btn" onclick="pressNum('7')">7</button>
        <button class="calc-btn" onclick="pressNum('8')">8</button>
        <button class="calc-btn" onclick="pressNum('9')">9</button>
        <button class="calc-btn op" onclick="pressOp('*')">×</button>
        <button class="calc-btn" onclick="pressNum('4')">4</button>
        <button class="calc-btn" onclick="pressNum('5')">5</button>
        <button class="calc-btn" onclick="pressNum('6')">6</button>
        <button class="calc-btn op" onclick="pressOp('-')">-</button>
        <button class="calc-btn" onclick="pressNum('1')">1</button>
        <button class="calc-btn" onclick="pressNum('2')">2</button>
        <button class="calc-btn" onclick="pressNum('3')">3</button>
        <button class="calc-btn op" onclick="pressOp('+')">+</button>
        <button class="calc-btn" onclick="pressNum('0')">0</button>
        <button class="calc-btn" onclick="pressDot()">.</button>
        <button class="calc-btn" onclick="pressPercent()">%</button>
        <button class="calc-btn eq" onclick="calculate()">=</button>
      </div>
    </div>
  </div>
  <script>
    // Service Worker 등록
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('ServiceWorker registration successful');
            
            // 새로운 버전이 있는지 확인
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // 새 버전이 설치되었을 때 페이지 새로고침
                  window.location.reload();
                }
              });
            });
          })
          .catch(err => {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }

    // 환율 정보 (예시)
    let rates = {
      'CADUSD': 0.72,
      'USDCAD': 1/0.72,
      'USDKRW': 1438,
      'KRWUSD': 1/1438,
      'CADKRW': 1040,
      'KRWCAD': 1/1040
    };
    let from = { code: 'CAD', flag: 'https://flagcdn.com/ca.svg' };
    let to = { code: 'USD', flag: 'https://flagcdn.com/us.svg' };
    let input = '0';
    let operator = '';
    let operand = '';
    let justCalculated = false;

    function getRate() {
      return rates[from.code + to.code] || 1;
    }

    function updateUI() {
      document.getElementById('from-flag').src = from.flag;
      document.getElementById('from-code').textContent = from.code;
      document.getElementById('to-flag').src = to.flag;
      document.getElementById('to-code').textContent = to.code;
      document.getElementById('calc-display').value = input;
      let fromValue = parseFloat(input) || 0;
      let rate = getRate();
      let toValue = fromValue * rate;
      document.getElementById('from-value').textContent = input;
      document.getElementById('to-value').textContent = (fromValue ? toValue.toLocaleString('en-US', {maximumFractionDigits: 6}) : '0');
    }

    function swapCurrency() {
      [from, to] = [to, from];
      input = '0';
      operator = '';
      operand = '';
      justCalculated = false;
      updateUI();
    }

    function clearAll() {
      input = '0';
      operator = '';
      operand = '';
      justCalculated = false;
      updateUI();
    }

    function backspace() {
      if (justCalculated) {
        input = '0';
        justCalculated = false;
      } else {
        input = input.length > 1 ? input.slice(0, -1) : '0';
      }
      updateUI();
    }

    function pressNum(n) {
      if (justCalculated) {
        input = n;
        justCalculated = false;
      } else {
        if (input === '0') input = n;
        else input += n;
      }
      updateUI();
    }

    function pressDot() {
      if (justCalculated) {
        input = '0.';
        justCalculated = false;
      } else if (!input.includes('.')) {
        input += '.';
      }
      updateUI();
    }

    function pressOp(op) {
      if (operator && operand) {
        calculate();
        operand = input;
      } else {
        operand = input;
      }
      operator = op;
      input = '0';
      justCalculated = false;
    }

    function pressPercent() {
      input = (parseFloat(input) / 100).toString();
      updateUI();
    }

    function calculate() {
      let result = 0;
      let a = parseFloat(operand) || 0;
      let b = parseFloat(input) || 0;
      switch (operator) {
        case '+': result = a + b; break;
        case '-': result = a - b; break;
        case '*': result = a * b; break;
        case '/': result = b !== 0 ? a / b : 0; break;
        default: result = b;
      }
      input = result.toString();
      operator = '';
      operand = '';
      justCalculated = true;
      updateUI();
    }

    // 최초 UI 세팅
    updateUI();
  </script>
</body>
</html>
