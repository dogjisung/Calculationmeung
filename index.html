<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ÌôòÏú®Í≥ÑÏÇ∞</title>
  <style>
    :root {
      --bg: #fff; --fg: #222; --btn-bg: #e0e0e0; --op-bg: #fbc02d; --eq-bg: #4caf50;
    }
    [data-theme="dark"] {
      --bg: #121212; --fg: #eee; --btn-bg: #333; --op-bg: #bb8c20; --eq-bg: #388e3c;
    }
    [data-theme="pastel"] {
      --bg: #fdf6e3; --fg: #657b83; --btn-bg: #eee8d5; --op-bg: #b58900; --eq-bg: #2aa198;
    }
    [data-theme="mono"] {
      --bg: #fafafa; --fg: #333; --btn-bg: #ccc; --op-bg: #999; --eq-bg: #666;
    }
    html,body{margin:0;padding:0;width:100vw;height:100vh;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto;}
    .container{max-width:360px;margin:0 auto;height:100%;display:flex;flex-direction:column;}
    .top{position:relative;padding:12px;border-bottom:1px solid #888;}
    .settings-btn{position:absolute;top:12px;right:12px;font-size:24px;background:none;border:none;color:var(--fg);cursor:pointer;}
    .row{display:flex;align-items:center;margin:8px 0;}
    select {flex:1;padding:6px;font-size:16px;}
    .rate{flex:1;font-size:24px;font-weight:700;text-align:right;}
    .stamp{text-align:center;font-size:12px;color:var(--fg);opacity:0.7;}
    .keypad{flex:1;display:grid;grid-template-columns:repeat(4,1fr);gap:8px;padding:12px;}
    .keypad button{padding:16px;font-size:20px;border:none;border-radius:8px;background:var(--btn-bg);color:var(--fg);cursor:pointer;}
    .keypad button.op{background:var(--op-bg);color:#fff;}
    .keypad button.eq{background:var(--eq-bg);color:#fff;grid-column:span 2;}
  </style>
</head>
<body data-theme="">
  <div class="container">
    <div class="top">
      <button class="settings-btn" onclick="location='settings.html'">‚öô</button>
      <div class="row">
        <select id="base"></select>
        <div class="rate" id="val1">0</div>
      </div>
      <div class="row">
        <select id="target"></select>
        <div class="rate" id="val2">0</div>
      </div>
      <div class="stamp" id="time">Ï°∞Ìöå ÏãúÍ∞Ñ: --</div>
      <div class="stamp" id="unit">1 = --</div>
    </div>
    <div class="keypad" id="pad">
      <button data-key="C">C</button><button data-key="‚Üê">‚Üê</button>
      <button data-action="swap">üîÑ</button><button class="op" data-op="/">√∑</button>
      <button data-key="7">7</button><button data-key="8">8</button>
      <button data-key="9">9</button><button class="op" data-op="*">√ó</button>
      <button data-key="4">4</button><button data-key="5">5</button>
      <button data-key="6">6</button><button class="op" data-op="-">‚àí</button>
      <button data-key="1">1</button><button data-key="2">2</button>
      <button data-key="3">3</button><button class="op" data-op="+">Ôºã</button>
      <button data-key="0">0</button><button data-key=".">.</button>
      <button class="eq" data-action="calc">Ôºù</button>
    </div>
  </div>

  <script>
    const pad=document.getElementById('pad'),
          baseSel=document.getElementById('base'),
          tgtSel=document.getElementById('target'),
          v1=document.getElementById('val1'),
          v2=document.getElementById('val2'),
          tm=document.getElementById('time'),
          ut=document.getElementById('unit'),
          body=document.body;

    let expr='';
    function fmt(n){
      return Number(n).toLocaleString();
    }
    function update1(){ v1.textContent=expr||'0'; }

    async function convert(){
      let amt;
      try{ amt=eval(expr||'0'); }
      catch{ amt=0; }
      amt=isNaN(amt)?0:amt;
      const f=baseSel.value, t=tgtSel.value;
      // ÏßÅÏ†ë ÏÑ§Ï†ïÎêú ÌôòÏú® Ïö∞ÏÑ†
      const custom=localStorage.getItem('customRate');
      const res= await fetch(`https://api.frankfurter.app/latest?from=${f}&to=${t}`);
      const js=await res.json();
      const rate=custom?Number(custom):js.rates[t];
      tm.textContent='Ï°∞Ìöå ÏãúÍ∞Ñ: '+new Date().toLocaleString();
      ut.textContent=`1 ${f} = ${ (t==='KRW'?Math.round(rate):rate.toFixed(6)).toLocaleString() } ${t}`;
      v2.textContent=fmt(amt*rate);
    }

    function initCurs(){
      // ÌÜµÌôî Î™©Î°ù
      ['KRW','USD','EUR','JPY','CNY','VND','THB','PHP','RUB','HKD'].forEach(c=>{
        [baseSel,tgtSel].forEach(sel=>{
          const opt=new Option(c,c);
          sel.add(opt);
        });
      });
      baseSel.value='USD'; tgtSel.value='KRW';
      baseSel.onchange=convert;
      tgtSel.onchange=convert;
      // ÌÖåÎßà
      const theme=localStorage.getItem('theme')||'';
      body.dataset.theme=theme;
    }

    pad.addEventListener('click',e=>{
      const k=e.target.dataset.key,
            a=e.target.dataset.action,
            o=e.target.dataset.op;
      if(k!=null){
        if(k==='C'){ expr=''; v2.textContent='0'; ut.textContent='1 = --'; tm.textContent='Ï°∞Ìöå ÏãúÍ∞Ñ: --'; }
        else if(k==='‚Üê'){ expr=expr.slice(0,-1); }
        else { expr+=k; }
        update1();
      } else if(o){
        expr+=o; update1();
      } else if(a==='swap'){
        [baseSel.value,tgtSel.value]=[tgtSel.value,baseSel.value];
        convert();
        expr=''; update1();
      } else if(a==='calc'){
        convert();
      }
    });

    window.onload=()=>{
      initCurs();
      update1();
      convert();
    };
  </script>
</body>
</html>
