<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>환율 계산기</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      background: #222;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      width: 100vw;
      height: 100vh;
      min-height: 100vh;
      min-width: 100vw;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .container {
      width: 100vw;
      height: 100vh;
      min-height: 100vh;
      min-width: 100vw;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      background: #222;
      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }
    .currency-block {
      width: 100vw;
      max-width: 480px;
      background: #333;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      border-radius: 0 0 18px 18px;
      flex: 0 0 22%;
      min-height: 0;
      justify-content: stretch;
      margin-top: 0.5vh; /* 더 위로 */
    }
    .currency-row {
      width: 100%;
      display: flex;
      align-items: flex-start; /* 위로 붙임 */
      justify-content: space-between;
      min-height: 0;
      padding: 0 24px;
      box-sizing: border-box;
      flex: 1 1 0;
      position: relative;
    }
    .currency-label {
      display: flex;
      align-items: center;
      font-size: 1.25em;
      min-width: 0;
    }
    .currency-label img {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      margin-right: 14px;
      flex-shrink: 0;
    }
    .currency-value-wrap {
      display: flex;
      align-items: flex-end;
      min-width: 0;
      justify-content: flex-end;
      flex: 1;
      height: 64px;
    }
    .currency-value {
      font-size: 2em;
      font-weight: bold;
      letter-spacing: 1px;
      text-align: right;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: clip;
      max-width: 50vw;
      min-width: 0;
      margin-left: 10px;
      direction: ltr;
      line-height: 1.1;
      color: #fff;
      display: inline-block;
      vertical-align: bottom;
    }
    .formula-inline {
      color: #bbb;
      font-size: 1.2em;
      margin-left: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: clip;
      max-width: 40vw;
      font-family: 'Segoe UI', 'monospace', sans-serif;
      vertical-align: bottom;
      display: inline-block;
      line-height: 1.1;
    }
    .currency-divider {
      width: 100%;
      height: 3px;
      background: #444;
      margin: 0;
      flex: 0 0 3px;
    }
    .calc-area {
      width: 100vw;
      max-width: 480px;
      background: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      flex: 1 1 70%;
      min-height: 0;
      padding: 0;
      margin: 0;
      margin-top: -1.5vh; /* 더 위로 */
    }
    .calc-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(5, 1fr);
      gap: 0;
      width: 100vw;
      max-width: 480px;
      height: calc(100vh - 22vh - 64px - 44px);
      min-height: 320px;
      margin: 0 auto;
      padding: 0;
      flex: 1 1 auto;
      align-items: stretch;
      justify-items: stretch;
    }
    .calc-btn {
      font-size: 1.15em;
      padding: 0;
      border: none;
      border-radius: 0;
      background: #444;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
      font-weight: 500;
      outline: none;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
    }
    .calc-btn:active { background: #555; }
    .op, .eq {
      background: #ff9800;
      color: #fff;
    }
    .op:active, .eq:active {
      background: #ffa726;
    }
    .footer-bar {
      width: 100vw;
      max-width: 480px;
      background: #222;
      color: #3fc46a;
      font-size: 1em;
      text-align: left;
      padding: 8px 0 4px 12px;
      box-sizing: border-box;
      border-top: 1px solid #333;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 0;
      z-index: 10;
    }
    .footer-bar .rate {
      color: #bfcfcf;
      font-size: 0.95em;
      margin-top: 2px;
      display: block;
    }
    @media (max-width: 500px) {
      .currency-block, .calc-area, .calc-buttons, .footer-bar { max-width: 100vw; }
      .currency-row { padding-left: 10px; padding-right: 10px; }
      .currency-value { max-width: 60vw; }
      .formula-inline { max-width: 30vw; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="currency-block" id="currency-block">
      <div class="currency-row" id="row-from">
        <div class="currency-label">
          <img id="from-flag" src="https://flagcdn.com/us.svg" alt="USD">
          <span id="from-code">USD</span>
        </div>
        <div class="currency-value-wrap">
          <span class="currency-value" id="from-value">0</span>
          <span class="formula-inline" id="formula-inline"></span>
        </div>
      </div>
      <div class="currency-divider"></div>
      <div class="currency-row" id="row-to">
        <div class="currency-label">
          <img id="to-flag" src="https://flagcdn.com/kr.svg" alt="KRW">
          <span id="to-code">KRW</span>
        </div>
        <div class="currency-value" id="to-value">0</div>
      </div>
    </div>
    <div class="calc-area">
      <div class="calc-buttons">
        <button class="calc-btn" onclick="clearAll()">C</button>
        <button class="calc-btn" onclick="backspace()">&larr;</button>
        <button class="calc-btn" onclick="swapCurrency()">&#8597;</button>
        <button class="calc-btn op" onclick="pressOp('/')">÷</button>
        <button class="calc-btn" onclick="pressNum('7')">7</button>
        <button class="calc-btn" onclick="pressNum('8')">8</button>
        <button class="calc-btn" onclick="pressNum('9')">9</button>
        <button class="calc-btn op" onclick="pressOp('*')">×</button>
        <button class="calc-btn" onclick="pressNum('4')">4</button>
        <button class="calc-btn" onclick="pressNum('5')">5</button>
        <button class="calc-btn" onclick="pressNum('6')">6</button>
        <button class="calc-btn op" onclick="pressOp('-')">-</button>
        <button class="calc-btn" onclick="pressNum('1')">1</button>
        <button class="calc-btn" onclick="pressNum('2')">2</button>
        <button class="calc-btn" onclick="pressNum('3')">3</button>
        <button class="calc-btn op" onclick="pressOp('+')">+</button>
        <button class="calc-btn" onclick="pressNum('0')">0</button>
        <button class="calc-btn" onclick="pressDot()">.</button>
        <button class="calc-btn" onclick="pressPercent()">%</button>
        <button class="calc-btn eq" onclick="calculate()">=</button>
      </div>
    </div>
    <div class="footer-bar" id="footer-bar">
      <span id="date-time"></span><br>
      <span class="rate" id="rate-info"></span>
    </div>
  </div>
  <script>
    // 환율 정보 (예시)
    let rates = {
      'USDKRW': 1438,
      'KRWUSD': 1/1438
    };
    let from = { code: 'USD', flag: 'https://flagcdn.com/us.svg' };
    let to = { code: 'KRW', flag: 'https://flagcdn.com/kr.svg' };
    let input = '';
    let formulaArr = []; // 수식 배열

    // 최대 입력 가능 숫자 (999,999,999,999,999)
    const MAX_NUMBER = 999_999_999_999_999;

    function getRate() {
      return rates[from.code + to.code] || 1;
    }

    function updateUI() {
      // 메인 숫자(마지막 입력이 숫자면 그 값, 아니면 직전 숫자)
      let mainValue = getMainValue();
      document.getElementById('from-flag').src = from.flag;
      document.getElementById('from-code').textContent = from.code;
      document.getElementById('to-flag').src = to.flag;
      document.getElementById('to-code').textContent = to.code;
      document.getElementById('from-value').textContent = mainValue.replace(/\B(?=(\d{3})+(?!\d))/g, ',') || '0';
      let fromValue = parseFloat(mainValue) || 0;
      let rate = getRate();
      let toValue = fromValue * rate;
      document.getElementById('to-value').textContent = (fromValue ? toValue.toLocaleString('en-US', {maximumFractionDigits: 0}) : '0');
      document.getElementById('formula-inline').innerHTML = getFormulaInline();
      updateFooter();
    }

    function getMainValue() {
      // 마지막이 숫자면 그 값, 연산자면 직전 숫자
      if (formulaArr.length === 0) return '0';
      if (typeof formulaArr[formulaArr.length - 1] === 'string' && !isOperator(formulaArr[formulaArr.length - 1])) {
        return formulaArr[formulaArr.length - 1];
      }
      for (let i = formulaArr.length - 1; i >= 0; i--) {
        if (!isOperator(formulaArr[i])) return formulaArr[i];
      }
      return '0';
    }

    function getFormulaInline() {
      if (formulaArr.length === 0) return '';
      let html = '';
      for (let i = 0; i < formulaArr.length; i++) {
        if (i === formulaArr.length - 1 && !isOperator(formulaArr[i])) continue; // 마지막 숫자는 메인 숫자에만
        if (isOperator(formulaArr[i])) {
          let op = formulaArr[i];
          if (op === '*') op = '×';
          if (op === '/') op = '÷';
          html += `<span style="color:#bbb;font-weight:normal;">${op}</span>`;
        } else {
          html += `<span style="color:#fff;font-weight:bold;">${Number(formulaArr[i]).toLocaleString('en-US')}</span>`;
        }
      }
      return html;
    }

    function isOperator(val) {
      return ['+', '-', '*', '/'].includes(val);
    }

    function swapCurrency() {
      [from, to] = [to, from];
      input = '';
      formulaArr = [];
      updateUI();
    }

    function clearAll() {
      input = '';
      formulaArr = [];
      updateUI();
    }

    function backspace() {
      if (formulaArr.length === 0) {
        input = '';
      } else {
        let last = formulaArr[formulaArr.length - 1];
        if (!isOperator(last)) {
          if (last.length > 1) {
            formulaArr[formulaArr.length - 1] = last.slice(0, -1);
          } else {
            formulaArr.pop();
          }
        } else {
          formulaArr.pop();
        }
      }
      updateUI();
    }

    function pressNum(n) {
      if (formulaArr.length === 0 || isOperator(formulaArr[formulaArr.length - 1])) {
        formulaArr.push(n);
      } else {
        let next = formulaArr[formulaArr.length - 1] + n;
        if (next.replace(/\D/g, '').length > 15) return;
        if (parseFloat(next.replace(/,/g, '')) > MAX_NUMBER) return;
        formulaArr[formulaArr.length - 1] = next;
      }
      updateUI();
    }

    function pressDot() {
      if (formulaArr.length === 0 || isOperator(formulaArr[formulaArr.length - 1])) {
        formulaArr.push('0.');
      } else if (!formulaArr[formulaArr.length - 1].includes('.')) {
        formulaArr[formulaArr.length - 1] += '.';
      }
      updateUI();
    }

    function pressOp(op) {
      if (formulaArr.length === 0) return;
      if (isOperator(formulaArr[formulaArr.length - 1])) {
        formulaArr[formulaArr.length - 1] = op;
      } else {
        formulaArr.push(op);
      }
      updateUI();
    }

    function pressPercent() {
      if (formulaArr.length === 0 || isOperator(formulaArr[formulaArr.length - 1])) return;
      let val = parseFloat(formulaArr[formulaArr.length - 1]);
      if (!isNaN(val)) {
        formulaArr[formulaArr.length - 1] = (val / 100).toString();
      }
      updateUI();
    }

    function calculate() {
      if (formulaArr.length === 0) return;
      // 마지막이 연산자면 제거
      if (isOperator(formulaArr[formulaArr.length - 1])) {
        formulaArr.pop();
      }
      let exp = '';
      for (let i = 0; i < formulaArr.length; i++) {
        let v = formulaArr[i];
        if (isOperator(v)) {
          exp += v;
        } else {
          exp += (parseFloat(v) || 0);
        }
      }
      let result = 0;
      try {
        result = eval(exp);
      } catch (e) {
        result = 0;
      }
      formulaArr = [result.toString()];
      updateUI();
    }

    // 하단 날짜/환율 표시
    function updateFooter() {
      const now = new Date();
      const y = now.getFullYear() % 100;
      const m = now.getMonth() + 1;
      const d = now.getDate();
      let h = now.getHours();
      const min = now.getMinutes().toString().padStart(2, '0');
      const isPM = h >= 12;
      if (h > 12) h -= 12;
      if (h === 0) h = 12;
      const timeStr = `${y}/${m}/${d} ${isPM ? '오후' : '오전'} ${h}:${min}`;
      document.getElementById('date-time').textContent = timeStr;
      document.getElementById('rate-info').textContent = `1 ${from.code} = ${getRate().toLocaleString('en-US', {maximumFractionDigits: 3})} ${to.code}`;
    }

    // 최초 UI 세팅 및 1분마다 하단 갱신
    updateUI();
    setInterval(updateFooter, 60000);
  </script>
</body>
</html>
